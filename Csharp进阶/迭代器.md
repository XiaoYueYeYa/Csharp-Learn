## 迭代器是什么
迭代器 (`iterator`) 有时又称光标(`cursor`)
是程序设计的**软件设计模式**
迭代器模式提供一个方法顺序**访问一个聚合对象中的各个元素**
而**又不暴露其内部的标识**

在表现效果上看
是**可以在容器对象(例如链表或数组)上遍历访问的接口**
设计员**无需关系容器对象的内存分配的实现细节**
可以用**foreach遍历的类 都是实现了迭代器的**

### 标准迭代器的实现方法
关键接口:`IEnumerator`,`IEnumerable`
命名空间:
```C#
using System.Collections;
```
可以通过同时继承`IEnumerable`和`IEnumerator`实现其中的方法

```C#
class CustomList:IEnumerable,IEnumerator
{
    private int[] list;
    //从-1开始的光标 用于表示 数据得到了哪个位置
    private int position = -1;
    
    public CustomList()
    {
        list = new int[] { 1, 2, 3, 4, 5, 6, 7, 8 };
    }

    #region IEnumerable
    public IEnumerator GetEnumerator()
    {
        Reset();
        return this;
    }

    #endregion

    public object Current
    {
        get
        {
            return list[position];
        }
    }

    public bool MoveNext()
    {
        //移动光标
        ++position;
        //是否溢出 溢出就不合法
        return position < list.Length;
    }

    //reset是重置光标位置 一般写在获取 IEnumerator对象这个函数中
    //用于第一次重置光标位置
    public void Reset()
    {
        position = -1;
    }


}
```

### 用yield return语法糖实现迭代器
`yield return` 是C#提供给我们的语法糖
所谓语法糖 也称糖衣语法
主要作用就是将复杂逻辑简单化 可以增加程序的可读性
从而减少程序代码出错的机会

关键接口:`IEnumerable`
命名空间:
```C#
using System.Collections;
```
让想要通过`foreach`遍历的自定义类实现接口中的方法`GetEnumerator`即可
```C#
class CustomList2 : IEnumerable
{
    private int[] list;
    public CustomList2()
    {
        list = new int[] { 1,2,3,4,5,6,7,8 };
    }
    public IEnumerator GetEnumerator()
    {
        for (int i = 0; i < list.Length; ++i)
        {
            yield return list[i];
        }
    }
}
```

### 用yield return 语法糖为泛型类实现迭代器

```C#
class CustomList<T> : IEnumerable
{
    private T[] array;
    public CustomList(params T[] array)
    {
        this.array = array;
    }

    public IEnumerator GetEnumerator()
    {
        for(int i = 0; i < array.Length; i++)
        {
            yield return array[i];
        }
    }
}
```

### foreach本质

1.先获取in后面这个对象的`IEnumerator`
会调用对象其中的`GetEnumerator`方法来获取
2.执行得到这个`IEnumerator`对象中的 `MoveNext`方法
3.只要`MoveNext`方法返回值是`true` 就会去得到`Current`
然后复制给 `item`
```C#
foreach (int item in list)
{
    Console.WriteLine(item);
}
Console.WriteLine("CustomList2");
CustomList2 list2 = new CustomList2();
foreach (int item in list2)
{
    Console.WriteLine(item);
}
Console.WriteLine("CustomList<t>");
CustomList<string> list3 = new CustomList<string>("123","123","312","3456");
foreach (string item in list3)
{
    Console.WriteLine(item);
}
```