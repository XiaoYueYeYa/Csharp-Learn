## 了解线程前先了解进程

进程(Process)是计算机中程序关于某数据集合上的一次运行活动
是系统进行资源分配和调度的基本单位 是操作系统构造的基础
说人话就是:打开一个应用程序就是在操作系统上开启了一个进程
进行之间可以互相读音运行 互不干扰
进程之间也可以互相访问 操作

## 什么是线程
操作系统能够进行运算调度的最小单位
它被包含在进程只中 是进程中的实际运作单位
一条线程指的是进程中一个单一顺序的控制流 一个进程中可以并发多个线程
我们目前写的程序 都在主进程中

简单理解线程:
就是代码从上带下运行的一条"管道"

## 什么是多线程
我们可以通过代码 开启新的线程
可以同时运行代码的多条"管道"就叫多线程

### 语法相关
线程类 `Thread`
需要引用命名空间
1.声明一个**新的线程**
**注意:线程执行的代码 需要封装到一个函数中**
新线程 将要执行的代码逻辑 被**封装到了一个函数语句块中**
```C#
Thread t = new Thread(NewThreadLogic);
```

```C#
static void NewThreadLogic()
{
    
}
```
2.启动线程
```C#
t.Start();
```
3.设置为后台线程
当前台线程都结束了的时候 整个程序要就结束了 即使还有后台线程正在运行
后台线程不会防止应用程序的进程被终止掉
如果不设置为后台线程 可能会导致进程无法被正常关闭
```C#
t.IsBackground = true;
```

4.关闭释放一个线程
如果开启的线程中不是死循环 是能够结束的逻辑 那么 不用刻意的去关闭它
如果是死循环 想要终止这个线程 有两种方式
4-1.死循环中bool标识
```C#
static bool isRuning = true;
```

```C#
Console.ReadKey();
isRuning = false;
Console.ReadKey();
```

4-2.通过线程提供的方法(**注意在.Net.core版本中无法终止 会报错**
终止线程

 ```C#
 try
{
    t.Abort();
    t=null;
}
catch
{
    Console.WriteLine(".Net.core版本中无法使用.Abort()终止");
}
 ``` 

5.线程休眠
**让线程休眠多少毫秒**(主线程亦可以)
在哪个线程里执行 就休眠哪个线程
```C#
Thread.Sleep(1000);
```

### 线程之间共享数据
多个线程使用的内存是共享的 抖属于改应用程序(进程)
所以要注意 当线程 同时操作同一片内存区域时可能会出现问题
可以通过加锁的形式避免问题

关键词:`lock`
当我们在多个线程当中访问同样的东西 进行逻辑处理时
为了避免不必要的逻辑循序执行的差错

作用:在同一个引用类型对象时要互相等对方执行完才会执行
缺点:会降低代码执行效率
语法: `lock(引用类型对象){}`
```C#
static object obj = new object();
```

```C#
while (true)
{
    lock (obj)
    {
        Console.SetCursorPosition(0, 2);
        Console.ForegroundColor = ConsoleColor.Red;
        Console.Write("♀");
    }
}
```

### 多线程对于我们的意义
可以用多线程专门处理一下复杂耗时的逻辑
比如寻路 网络通信等等.

## 总结
多线程是多个可以同时执行的代码逻辑的"管道"
可以通过代码开启多线程 用多线程处理一下复杂的可能影响主线程流畅度的逻辑
关键词 `Thread`

---

## 练习
控制台中有一个■
它会如贪吃蛇一样自动移动
请开启一个多线程来检测输入 来控制它的转向

```C#
//方向枚举
enum E_Direction
{
    W,
    A,
    S,
    D,
}
```

```C#
//位置信息
static int x = 55;
static int y = 15;
//默认方向
static E_Direction e_Direction = E_Direction.A;
//多线程停止标识
static bool stop = true;

```

```C#
#region 默认设置
//清空
Console.Clear();
//窗口大小
Console.SetWindowSize(110, 30);
//打印字体颜色
Console.ForegroundColor = ConsoleColor.Red;
```

```C#
//主循环
while (true)
{
    //换方向移动
    switch (e_Direction)
    {
        case E_Direction.W:
            y -= 2;
            break;
        case E_Direction.A:
            x -= 2;
            break;
        case E_Direction.S:
            y += 2;
            break;
        case E_Direction.D:
            x += 2;
            break;
    }
    try
    {
        Thread.Sleep(50);
        Console.Clear();
        Console.SetCursorPosition(x, y);
        Console.Write("■");
    }
    catch
    {
        stop = false;
        thread = null;
        Console.WriteLine("死了");
        break;
    }
}
```

```C#
Thread thread = new Thread(NewThreadLogic);
thread.Start();
thread.IsBackground = true;
```


```C#
//多线程移动方向
static void NewThreadLogic()
{
    while (stop)
    {
        if (Console.KeyAvailable)
        {
            string str = null;
            str += Console.ReadKey(true).KeyChar;
            //Console.WriteLine("按下了" + str.ToUpper());
            if (str.ToUpper() == "W")
            {
                e_Direction = E_Direction.W;
            }
            else if (str.ToUpper() == "A")
            {
                e_Direction = E_Direction.A;
            }
            else if (str.ToUpper() == "S")
            {
                e_Direction = E_Direction.S;
            }
            else if (str.ToUpper() == "D")
            {
                e_Direction = E_Direction.D;
            }
        }
    }
}
```


## 练习2
